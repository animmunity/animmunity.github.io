<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Home - AniMMunity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>
<body>

  <!-- Header -->
  <div id="header-placeholder"></div>

  <!-- Contenuto principale -->
  <main class="anime-main">
    <h1>Benvenuto su AniMMunity</h1>
    <p>Scopri il nostro archivio anime aggiornato in tempo reale.</p>

    <!-- Campo di ricerca -->
    <input type="text" id="searchInput" placeholder="Cerca un anime..." class="search-bar" />

    <!-- Elenco anime -->
    <div id="animeCards" class="anime-cards"></div>
  </main>

  <!-- Footer -->
  <div id="footer-placeholder"></div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- Includi header/footer -->
  <script>
    fetch("header.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("header-placeholder").innerHTML = data;
      });

    fetch("footer.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("footer-placeholder").innerHTML = data;
      });

    // Funzione per caricare e visualizzare i dati
    $(document).ready(function () {
      $.ajax({
        url: "https://animmunity.github.io/data/anime.csv",
        dataType: "text",
        success: function (data) {
          const rows = data.trim().split("\n");
          const headers = rows[0].split(",");
          const titleIndex = headers.indexOf("title");
          const pictureIndex = headers.indexOf("main_picture");
          const synopsisIndex = headers.indexOf("synopsis");

          const animeData = rows.slice(1).map(row => {
            const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // split by comma, ignore commas in quotes
            return {
              title: values[titleIndex],
              main_picture: values[pictureIndex],
              synopsis: values[synopsisIndex]
            };
          });

          // Mostra le card
          renderCards(animeData);

          // Ricerca dinamica
          $('#searchInput').on('input', function () {
            const query = $(this).val().toLowerCase();
            const filtered = animeData.filter(anime =>
              anime.title.toLowerCase().includes(query) ||
              anime.synopsis.toLowerCase().includes(query)
            );
            renderCards(filtered);
          });
        }
      });

      function renderCards(data) {
        const container = $("#animeCards");
        container.empty();

        if (data.length === 0) {
          container.append("<p>Nessun risultato trovato.</p>");
          return;
        }

        data.forEach(anime => {
          container.append(`
            <div class="anime-card">
              <img src="${anime.main_picture}" alt="${anime.title}" class="anime-image" />
              <div class="anime-info">
                <h3 class="anime-title">${anime.title}</h3>
                <p class="anime-synopsis">${anime.synopsis.slice(0, 250)}...</p>
              </div>
            </div>
          `);
        });
      }
    });
  </script>
</body>
</html>
