<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Elenco Anime</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="header"></div>
  <main>
    <h1>Anime List</h1>
    <ul id="anime-list"></ul>
  </main>
  <div id="footer"></div>

  <script>
    async function loadHTML(id, url) {
      const res = await fetch(url);
      const html = await res.text();
      document.getElementById(id).innerHTML = html;
    }

    loadHTML("header", "templates/header.html");
    loadHTML("footer", "templates/footer.html");

    async function loadCSV() {
      const res = await fetch("data/anime.csv");
      const csv = await res.text();

      const lines = csv.split("\n");
      const headers = lines[0].split(",");
      const titleIndex = headers.indexOf("title");
      const idIndex = headers.indexOf("anime_id");

      const list = document.getElementById("anime-list");

      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(",");
        const title = cols[titleIndex];
        const id = cols[idIndex];
        if (!title || !id) continue;

        const li = document.createElement("li");
        li.innerHTML = `<a href="anime.html?id=${id}">${title}</a>`;
        list.appendChild(li);
      }
    }

    loadCSV();
  </script>
</body>
</html>
