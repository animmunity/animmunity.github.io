<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Anime Info</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      font-family: 'Nunito Sans', sans-serif;
      margin: 0;
      background-color: #f7f9fc;
      color: #333;
    }

    .anime-card {
      max-width: 900px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 2rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .anime-card img.cover {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
    }

    .anime-card h1 {
      margin-bottom: 1rem;
      color: #2c3e50;
      font-size: 2rem;
    }

    .anime-card section {
      margin-top: 2rem;
    }

    .anime-card h2 {
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
      color: #4D90D5;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.3rem;
    }

    .anime-card p {
      margin: 0.4rem 0;
      line-height: 1.6;
    }

    .anime-card a {
      color: #3498db;
      text-decoration: none;
    }

    .anime-card a:hover {
      text-decoration: underline;
    }

    .video {
      margin-top: 2rem;
      text-align: center;
    }

    iframe {
      width: 100%;
      max-width: 720px;
      height: 405px;
      border: none;
      border-radius: 1rem;
    }
  </style>
  <script>
    $(function () {
      $("#header").load("header.html");
      $("#footer").load("footer.html");
    });
  </script>
</head>
<body>
  <div id="header"></div>
  <div id="app" class="anime-card">Caricamento...</div>
  <div id="footer"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const animeId = urlParams.get('id');

    fetch("data/anime.csv")
      .then(res => res.text())
      .then(text => {
        const rows = text.trim().split("\n");
        const headers = rows[0].split(",");
        const data = rows.slice(1).map(row => {
          const values = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(v => v.replace(/^"|"$/g, '').trim());
          return headers.reduce((obj, key, i) => {
            obj[key] = values[i] || "";
            return obj;
          }, {});
        });

        const anime = data.find(a => a.anime_id === animeId);

        if (!anime) {
          document.getElementById("app").innerHTML = `<p>Anime non trovato<br>ID cercato: <code>${animeId}</code></p>`;
          return;
        }

        let html = `<h1>${anime.title}</h1>`;

        if (anime.main_picture)
          html += `<img class="cover" src="${anime.main_picture}" alt="${anime.title}">`;

        html += `<p><strong>Link:</strong> <a href="${anime.url}" target="_blank">${anime.url}</a></p>`;

        html += `<section><h2>Trama</h2><p>${anime.synopsis}</p></section>`;

        if (anime.trailer_url)
          html += `<div class="video"><iframe src="${anime.trailer_url.replace("watch?v=", "embed/")}" allowfullscreen></iframe></div>`;

        html += `<section><h2>Dati</h2>
          <p><strong>Tipo:</strong> ${anime.type}</p>
          <p><strong>Punteggio:</strong> ${anime.score} (${anime.scored_by} voti)</p>
          <p><strong>Episodi:</strong> ${anime.episodes}</p>
          <p><strong>Inizio:</strong> ${anime.start_date}</p>
          <p><strong>Fine:</strong> ${anime.end_date}</p>
        </section>`;

        document.getElementById("app").innerHTML = html;
      })
      .catch(err => {
        document.getElementById("app").innerHTML = `<p>Errore nel caricamento dati: ${err}</p>`;
      });
  </script>
</body>
</html>
