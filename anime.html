<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Anime Info</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      font-family: 'Nunito Sans', sans-serif;
      margin: 0;
      background-color: #f7f9fc;
      color: #333;
    }

    .anime-card {
      max-width: 900px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 2rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .anime-card img.cover {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
    }

    .anime-card h1 {
      margin-bottom: 1rem;
      color: #2c3e50;
      font-size: 2rem;
    }

    .anime-card section {
      margin-top: 2rem;
    }

    .anime-card h2 {
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
      color: #4D90D5;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.3rem;
    }

    .anime-card p {
      margin: 0.4rem 0;
      line-height: 1.6;
    }

    .anime-card a {
      color: #3498db;
      text-decoration: none;
    }

    .anime-card a:hover {
      text-decoration: underline;
    }

    .video {
      margin-top: 2rem;
      text-align: center;
    }

    iframe {
      width: 100%;
      max-width: 720px;
      height: 405px;
      border: none;
      border-radius: 1rem;
    }
  </style>
  <script>
    $(function () {
      $("#header").load("header.html");
      $("#footer").load("footer.html");
    });
  </script>
</head>
<body>
  <div id="header"></div>
  <div id="app" class="anime-card"></div>
  <div id="footer"></div>

  <script>
    const columnLabels = {
      "title": "Titolo", "title_english": "Titolo Inglese", "title_japanese": "Titolo Giapponese", "title_synonyms": "Titoli alternativi",
      "type": "Tipo", "score": "Punteggio", "scored_by": "Voti ricevuti", "status": "Stato", "rating": "Classificazione", "sfw": "Adatto a tutti",
      "episodes": "Episodi", "episode_duration": "Durata episodio", "total_duration": "Durata totale",
      "start_date": "Data inizio", "end_date": "Data fine", "real_start_date": "Inizio reale", "real_end_date": "Fine reale",
      "start_year": "Anno", "start_season": "Stagione", "broadcast_day": "Giorno", "broadcast_time": "Ora",
      "source": "Fonte", "studios": "Studi", "producers": "Produttori", "licensors": "Licenziatari",
      "members": "Membri", "favorites": "Preferiti", "approved": "Approvato",
      "genres": "Generi", "themes": "Temi", "demographics": "Demografia",
      "synopsis": "Trama", "background": "Contesto", "trailer_url": "Trailer",
      "created_at": "Creato il", "updated_at": "Aggiornato il"
    };

    const sections = {
      "Identità e Titoli": ["title", "title_english", "title_japanese", "title_synonyms"],
      "Classificazione": ["type", "score", "scored_by", "status", "rating", "sfw"],
      "Episodi e Durata": ["episodes", "episode_duration", "total_duration"],
      "Date e Programmazione": ["start_date", "end_date", "real_start_date", "real_end_date", "start_year", "start_season", "broadcast_day", "broadcast_time"],
      "Produzione": ["source", "studios", "producers", "licensors"],
      "Popolarità e Target": ["members", "favorites", "approved", "genres", "themes", "demographics"],
      "Contenuto": ["synopsis", "background", "trailer_url"],
      "Dati Tecnici": ["created_at", "updated_at"]
    };

    const urlParams = new URLSearchParams(window.location.search);
    const animeId = urlParams.get('id');

    fetch("data/anime.csv")
      .then(res => res.text())
      .then(text => {
        const rows = text.split("\n").filter(row => row.trim());
        const headers = rows[0].split(',').map(h => h.trim());
        const data = rows.slice(1).map(row => {
          const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.replace(/^"|"$/g, '').trim());
          return headers.reduce((acc, key, i) => {
            acc[key] = values[i];
            return acc;
          }, {});
        });

        const anime = data.find(d => d.anime_id === animeId);
        if (!anime) {
          document.getElementById('app').innerHTML = `<p>Anime non trovato<br>ID: ${animeId}</p>`;
          return;
        }

        let html = `<h1>${anime.title}</h1>`;
        if (anime.main_picture) {
          html += `<img class="cover" src="${anime.main_picture}" alt="${anime.title}">`;
        }
        html += `<p><strong>Link:</strong> <a href="${anime.url}" target="_blank">Scheda MyAnimeList</a></p>`;

        for (const section in sections) {
          html += `<section><h2>${section}</h2>`;
          for (const key of sections[section]) {
            const label = columnLabels[key];
            const value = anime[key];
            if (value && key !== "main_picture" && key !== "url") {
              if (key === "trailer_url" && value.includes("youtube.com")) {
                const embed = value.replace("watch?v=", "embed/");
                html += `<div class="video"><iframe src="${embed}" allowfullscreen></iframe></div>`;
              } else {
                html += `<p><strong>${label}:</strong> ${value}</p>`;
              }
            }
          }
          html += `</section>`;
        }

        document.getElementById('app').innerHTML = html;
      });
  </script>
</body>
</html>
